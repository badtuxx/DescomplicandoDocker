
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <title>Compartilhando as imagens · HonKit</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 3.6.20">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="chapter_10.html" />
    
    
    <link rel="prev" href="chapter_08.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Sobre</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Proposta do livro
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Capítulos</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="chapter_00.html">
            
                <a href="chapter_00.html">
            
                    
                    Introdução
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="chapter_01.html">
            
                <a href="chapter_01.html">
            
                    
                     O que é container
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="chapter_02.html">
            
                <a href="chapter_02.html">
            
                    
                    O que é o Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="chapter_03.html">
            
                <a href="chapter_03.html">
            
                    
                    Instalando o Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="chapter_04.html">
            
                <a href="chapter_04.html">
            
                    
                    Executando e administrando containers Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="chapter_05.html">
            
                <a href="chapter_05.html">
            
                    
                    Configurando CPU e memória para os meus containers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="chapter_06.html">
            
                <a href="chapter_06.html">
            
                    
                    Meu primeiro e tosco dockerfile...
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="chapter_07.html">
            
                <a href="chapter_07.html">
            
                    
                    Entendendo volumes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="chapter_08.html">
            
                <a href="chapter_08.html">
            
                    
                    Criando e gerenciando imagens
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.10" data-path="chapter_09.html">
            
                <a href="chapter_09.html">
            
                    
                    Compartilhando as imagens
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.11" data-path="chapter_10.html">
            
                <a href="chapter_10.html">
            
                    
                    Gerenciando a rede dos containers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.12" data-path="chapter_11.html">
            
                <a href="chapter_11.html">
            
                    
                    Controlando o daemon do Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.13" data-path="chapter_12.html">
            
                <a href="chapter_12.html">
            
                    
                    Docker Machine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.14" data-path="chapter_13.html">
            
                <a href="chapter_13.html">
            
                    
                    Docker Swarm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.15" data-path="chapter_14.html">
            
                <a href="chapter_14.html">
            
                    
                    Docker Secrets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.16" data-path="chapter_15.html">
            
                <a href="chapter_15.html">
            
                    
                    Docker Compose
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Compartilhando as imagens</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="9-compartilhando-as-imagens">9. Compartilhando as imagens</h1>
<p>Bem, já aprendemos como criar uma imagem de <em>container</em>, seja via
<em>dockerfile</em> ou através da modificação de um <em>container</em>, e conhecemos
alguns comandos interessantes, como o &quot;docker build&quot; e o &quot;docker
commit&quot;.</p>
<p>Agora vamos aprender a compartilhar essas imagens, seja em um <em>registry</em>
local ou então no <em>registry</em> do próprio Docker Hub.</p>
<h2 id="91-o-que-é-o-docker-hub">9.1. O que é o Docker Hub?</h2>
<p>Docker Hub é um repositório público e privado de imagens que
disponibiliza diversos recursos, como, por exemplo, sistema de
autenticação, <em>build</em> automático de imagens, gerenciamento de usuários e
departamentos de sua organização, entre outras funcionalidades.</p>
<p>Pessoas e empresas se juntam, criam seus <em>containers</em> seguindo as
melhores práticas, testam tudo direitinho e depois disponibilizam lá
para você usar sem ter nenhum trabalho. Isso é uma mão na roda
gigantesca, uma vez que você não vai ter que perder tempo instalando
coisas. Você também pode usá-lo para aprender como configurar
determinado serviço. Para isso, basta ir no Docker Hub e procurar;
provavelmente alguém já criou um <em>container</em> que você poderá usar pelo
menos de base!</p>
<p>Apesar dessa facilidade de encontrar coisas prontas, provavelmente você
não vai querer baixar da internet, mesmo que do <em>registry</em> do próprio
Docker (sério), e subir no seu ambiente de produção algo que você não
tem certeza de como funciona, o que é, etc.</p>
<p>Para resolver esse problema o Docker disponibiliza algumas
funcionalidades, como o comando &quot;docker image inspect&quot;, que já vimos
antes, quando falávamos de volumes, lembra? Naquele momento usamos a
<em>flag</em> &quot;-f&quot; e especificamos um campo de pesquisa, pois o intuito era
mostrar somente a parte que estava sendo discutida naquele capítulo. Mas
o &quot;docker image inspect&quot; vai muito além disso; sem passar o &quot;-f&quot; ele vai
retornar todas as informações contidas naquela imagem, desde a imagem
base que foi utilizada até pontos de montagem, configurações, enfim,
muita coisa. Teste aí:</p>
<pre><code class="lang-bash">root@linuxtips:~<span class="hljs-comment"># docker image inspect debian</span>
[
    {
        <span class="hljs-string">&quot;Id&quot;</span>: <span class="hljs-string">&quot;sha256:f50f9524513f5356d952965dc97c7e831b02bb6ea0619da9bfc1997e4b9781b7&quot;</span>,
        <span class="hljs-string">&quot;RepoTags&quot;</span>: [
            <span class="hljs-string">&quot;debian:8&quot;</span>,
            <span class="hljs-string">&quot;debian:latest&quot;</span>
        ],
        <span class="hljs-string">&quot;RepoDigests&quot;</span>: [],
        <span class="hljs-string">&quot;Parent&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,
        <span class="hljs-string">&quot;Comment&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,
        <span class="hljs-string">&quot;Created&quot;</span>: <span class="hljs-string">&quot;2016-03-01T18:51:14.143360029Z&quot;</span>,
        <span class="hljs-string">&quot;Container&quot;</span>: <span class="hljs-string">&quot;557177343b434b6797c19805d49c37728a4445d2610a6647c27055fbe4ec3451&quot;</span>,
        <span class="hljs-string">&quot;ContainerConfig&quot;</span>: {
            <span class="hljs-string">&quot;Hostname&quot;</span>: <span class="hljs-string">&quot;e5c68db50333&quot;</span>,
            <span class="hljs-string">&quot;Domainname&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,
            <span class="hljs-string">&quot;User&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,
            <span class="hljs-string">&quot;AttachStdin&quot;</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-string">&quot;AttachStdout&quot;</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-string">&quot;AttachStderr&quot;</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-string">&quot;Tty&quot;</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-string">&quot;OpenStdin&quot;</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-string">&quot;StdinOnce&quot;</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-string">&quot;Env&quot;</span>: null,
            <span class="hljs-string">&quot;Cmd&quot;</span>: [
                <span class="hljs-string">&quot;/bin/sh&quot;</span>,
                <span class="hljs-string">&quot;-c&quot;</span>,
                <span class="hljs-string">&quot;#(nop) CMD [&quot;</span>/bin/bash<span class="hljs-string">&quot;]&quot;</span>
            ],
            <span class="hljs-string">&quot;Image&quot;</span>: <span class="hljs-string">&quot;d8bd0657b25f17eef81a3d52b53da5bda4de0cf5cca3dcafec277634ae4b38fb&quot;</span>,
            <span class="hljs-string">&quot;Volumes&quot;</span>: null,
            <span class="hljs-string">&quot;WorkingDir&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,
            <span class="hljs-string">&quot;Entrypoint&quot;</span>: null,
            <span class="hljs-string">&quot;OnBuild&quot;</span>: null,
            <span class="hljs-string">&quot;Labels&quot;</span>: {}
        },
        <span class="hljs-string">&quot;DockerVersion&quot;</span>: <span class="hljs-string">&quot;1.9.1&quot;</span>,
        <span class="hljs-string">&quot;Author&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,
        <span class="hljs-string">&quot;Config&quot;</span>: {
            <span class="hljs-string">&quot;Hostname&quot;</span>: <span class="hljs-string">&quot;e5c68db50333&quot;</span>,
            <span class="hljs-string">&quot;Domainname&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,
            <span class="hljs-string">&quot;User&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,
            <span class="hljs-string">&quot;AttachStdin&quot;</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-string">&quot;AttachStdout&quot;</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-string">&quot;AttachStderr&quot;</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-string">&quot;Tty&quot;</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-string">&quot;OpenStdin&quot;</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-string">&quot;StdinOnce&quot;</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-string">&quot;Env&quot;</span>: null,
            <span class="hljs-string">&quot;Cmd&quot;</span>: [
                <span class="hljs-string">&quot;/bin/bash&quot;</span>
            ],
            <span class="hljs-string">&quot;Image&quot;</span>: <span class="hljs-string">&quot;d8bd0657b25f17eef81a3d52b53da5bda4de0cf5cca3dcafec277634ae4b38fb&quot;</span>,
            <span class="hljs-string">&quot;Volumes&quot;</span>: null,
            <span class="hljs-string">&quot;WorkingDir&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,
            <span class="hljs-string">&quot;Entrypoint&quot;</span>: null,
            <span class="hljs-string">&quot;OnBuild&quot;</span>: null,
            <span class="hljs-string">&quot;Labels&quot;</span>: {}
        },
        <span class="hljs-string">&quot;Architecture&quot;</span>: <span class="hljs-string">&quot;amd64&quot;</span>,
        <span class="hljs-string">&quot;Os&quot;</span>: <span class="hljs-string">&quot;linux&quot;</span>,
        <span class="hljs-string">&quot;Size&quot;</span>: 125110803,
        <span class="hljs-string">&quot;VirtualSize&quot;</span>: 125110803,
        <span class="hljs-string">&quot;GraphDriver&quot;</span>: {
            <span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;aufs&quot;</span>,
            <span class="hljs-string">&quot;Data&quot;</span>: null
        }
    }
]

root@linuxtips:~<span class="hljs-comment">#</span>
</code></pre>
<p>Às vezes será disponibilizado junto com a imagem o seu respectivo
<em>dockerfile</em> e aí fica bem mais fácil: basta ler esse arquivo para saber
exatamente como ela foi criada. :)</p>
<p>Um comando bastante interessante, que nos faz entender como uma imagem é
dividida em camadas (e, principalmente, o que foi feito em cada camada),
é o &quot;docker history&quot;.</p>
<pre><code class="lang-bash">root@linuxtips:~<span class="hljs-comment"># docker history linuxtips/apache:1.0</span>

IMAGE        CREATED        CREATED BY                                      SIZE         COMMENT
4862def18dfd 36 minutes ago /bin/sh -c <span class="hljs-comment">#(nop) EXPOSE 80/tcp                 0 B</span>
06210ac863da 36 minutes ago /bin/sh -c <span class="hljs-comment">#(nop) VOLUME [/var/www/html/]       0 B</span>
fed9b6bc7ad9 36 minutes ago /bin/sh -c <span class="hljs-comment">#(nop) LABEL description=Webserver   0 B</span>
68f6e8de3df3 36 minutes ago /bin/sh -c <span class="hljs-comment">#(nop) ENV APACHE_LOG_DIR=/var/log   0 B</span>
1a129e753d1e 36 minutes ago /bin/sh -c <span class="hljs-comment">#(nop) ENV APACHE_RUN_GROUP=www-da   0 B</span>
f0f9d7be7c70 36 minutes ago /bin/sh -c <span class="hljs-comment">#(nop) ENV APACHE_RUN_USER=www-dat   0 B</span>
3dafea4a403a 36 minutes ago /bin/sh -c <span class="hljs-comment">#(nop) ENV APACHE_PID_FILE=/var/ru   0 B</span>
f31eb176ecc8 36 minutes ago /bin/sh -c <span class="hljs-comment">#(nop) ENV APACHE_LOCK_DIR=/var/lo   0 B</span>
0bbefd91da05 36 minutes ago /bin/sh -c apt-get update &amp;&amp; apt-get install    68.29 MB
f50f9524513f 12 days ago    /bin/sh -c <span class="hljs-comment">#(nop) CMD [&quot;/bin/bash&quot;]             0 B</span>
&lt;missing&gt;    12 days ago    /bin/sh -c <span class="hljs-comment">#(nop) ADD file:b5393172fb513d       125.1MB</span>

root@linuxtips:~<span class="hljs-comment">#</span>
</code></pre>
<p>Perceba que as primeiras linhas da saída do comando anterior são
referentes às informações que pedimos para adicionar à imagem no
<em>dockerfile</em>. As demais camadas são originais da imagem que pegamos do
Docker Hub através da instrução &quot;FROM&quot;.</p>
<p>Existe também um site chamado &quot;ImageLayers&quot;: ele faz exatamente a mesma
coisa que o &quot;docker history&quot;, mas você não precisa baixar a imagem -- e,
bom, é <em>web</em>. O ImageLayers pode ser acessado em:
<a href="https://imagelayers.io/" target="_blank">https://imagelayers.io/</a>.</p>
<p>O Docker Hub, como já falamos, tem muitos componentes, dentre eles o
responsável pelo repositório de imagens: o <em>registry</em>.</p>
<p>É possível utilizar um <em>registry</em> local em vez de um na nuvem, como o
Docker Hub ou outros <em>registries</em> que são facilmente encontrados na
internet. Falaremos disso com detalhes mais à frente. :P</p>
<p>Para que você possa utilizar o Docker Hub para gerenciar as suas
imagens, é necessário criar uma conta.</p>
<h2 id="92-vamos-criar-uma-conta">9.2. Vamos criar uma conta?</h2>
<p>Para que consiga realizar a criação da sua conta, é necessário acessar a
URL <a href="https://hub.docker.com" target="_blank">https://hub.docker.com</a>.
Antes era possível através do comando &quot;docker login&quot;. Hoje, o comando
&quot;docker login&quot; somente é utilizado para autenticar no Docker Hub após a
criação da conta.</p>
<p>A partir da confirmação do seu e-mail, já é possível se autenticar e
começar a fazer uso do Docker Hub.</p>
<pre><code class="lang-bash">root@linuxtips:~<span class="hljs-comment"># docker login</span>
Login with your Docker ID to push and pull images from Docker Hub. If you don<span class="hljs-string">&apos;t have a Docker ID, head over to https://hub.docker.com to create one.

Username: linuxtips01
Password:
Login Succeeded

root@linuxtips:~#
</span></code></pre>
<p>Você consegue criar repositórios públicos à vontade, porém na conta
<em>free</em> você somente tem direito a um repositório privado. Caso precise
de mais do que um repositório privado, é necessário o <em>upgrade</em> da sua
conta e o pagamento de uma mensalidade. :)</p>
<p>Caso você queira especificar outro <em>registry</em> em vez do Docker Hub,
basta passar o endereço como parâmetro, como segue:</p>
<pre><code class="lang-bash"><span class="hljs-comment"># docker login registry.seilaqual.com</span>
</code></pre>
<h2 id="93-agora-vamos-compartilhar-essas-imagens-na-interwebs">9.3. Agora vamos compartilhar essas imagens na <em>interwebs</em>!</h2>
<p>Uma vez que já criamos a nossa conta no Docker Hub, podemos começar a
utilizá-la!</p>
<p>Como exemplo, vamos utilizar a imagem que montamos com o <em>dockerfile</em> no
capítulo anterior chamada &quot;linuxtips/apache&quot;. Quando realizarmos o
<em>upload</em> dessa imagem para o Docker Hub, o repositório terá o mesmo nome
da imagem, ou seja, &quot;linuxtips/apache&quot;.</p>
<p>Uma coisa muito importante! A sua imagem deverá ter o seguinte padrão,
para que você consiga fazer o <em>upload</em> para o Docker Hub:</p>
<p><strong>seuusuario/nomedaimagem:versão</strong></p>
<p>Assim, sabemos que &quot;linuxtips/apache:1.0&quot; significa:</p>
<ul>
<li><p><strong>linuxtips</strong> -- Usuário do Docker Hub.</p>
</li>
<li><p><strong>apache</strong> -- Nome da imagem.</p>
</li>
<li><p><strong>1.0</strong> -- Versão.</p>
</li>
</ul>
<p>Agora vamos utilizar o comando &quot;docker push&quot;, responsável por fazer o
<em>upload</em> da imagem da sua máquina local para o <em>registry</em> do Docker Hub,
como mostrado no exemplo a seguir:</p>
<pre><code class="lang-bash">root@linuxtips:~<span class="hljs-comment"># docker push linuxtips/apache:1.0</span>
The push refers to a repository [docker.io/linuxtips/apache]
b3a691489ee1: Pushed
5f70bf18a086: Layer already exists
917c0fc99b35: Pushed
1.0: digest: sha256:c8626093b19a686fd260dbe0c12db79a97ddfb6a6d8e4c4f44634f66991d93d0 size: 6861

root@linuxtips:~<span class="hljs-comment">#</span>
</code></pre>
<p>Acessando a URL
<a href="https://hub.docker.com/" target="_blank">https://hub.docker.com/</a>
você conseguirá visualizar o repositório que acabou de criar, conforme a
imagem a seguir:</p>
<p><img src="../media/image4.png" alt="REPOSITORIO NO DOCKER HUB"></p>
<p>Por padrão, ele cria o repositório como público. ;)</p>
<p>Caso você queira visualizar o seu novo repositório pela linha de
comando, basta utilizar o comando &quot;docker search&quot; seguido de seu usuário
do Docker Hub:</p>
<pre><code class="lang-bash">root@linuxtips:~<span class="hljs-comment"># docker search &lt;seu_usuario&gt;</span>

NAME                DESCRIPTION      STARS            OFFICIAL       AUTOMATED
linuxtips/apache                     0
</code></pre>
<p>Já que possuímos a imagem no <em>registry</em> do Docker Hub, vamos testá-la
fazendo o <em>pull</em> da imagem e em seguida vamos executando-a para saber se
realmente tudo isso funciona de forma simples e fácil assim. :)</p>
<p>Primeiro vamos parar os <em>containers</em> que utilizam a imagem
&quot;linuxtips/apache&quot;:</p>
<pre><code class="lang-bash"><span class="hljs-comment"># docker container ls | grep seu_usuario/sua_imagem</span>
<span class="hljs-comment"># docker container stop CONTAINERID</span>
</code></pre>
<p>Não é possível remover uma imagem se algum <em>container</em> estiver em
execução utilizando-a como imagem base. Por isso é necessário parar os
<em>containers</em> conforme fizemos antes.</p>
<p>Para que você possa remover uma imagem é necessário utilizar o comando
&quot;docker image rm&quot;, responsável por remover imagens do disco local.</p>
<p>É importante mencionar que, caso possua <em>containers</em> parados que
utilizam essa imagem como base, é necessário forçar a remoção da imagem
utilizando o parâmetro &quot;-f&quot;:</p>
<pre><code class="lang-bash"><span class="hljs-comment"># docker image rm -f linuxtips/apache:1.0</span>
Untagged: linuxtips/apache:1.0
</code></pre>
<p>Pronto! Removemos a imagem!</p>
<p>Agora vamos realizar o <em>pull</em> da imagem diretamente do <em>registry</em> do
Docker Hub para que tenhamos a imagem novamente em nosso disco local e
assim possamos subir um <em>container</em> utilizando-a.</p>
<pre><code class="lang-bash">root@linuxtips:~<span class="hljs-comment"># docker pull linuxtips/apache:1.0</span>
1.0: Pulling from linuxtips/apache
fdd5d7827f33: Already exists
a3ed95caeb02: Already exists
11b590220174: Already exists
Digest: sha256:c8626093b19a686fd260dbe0c12db79a97ddfb6a6d8e4c4f44634f66991d93d0
Status: Downloaded newer image <span class="hljs-keyword">for</span> linuxtips/apache:1.0

root@linuxtips:~<span class="hljs-comment">#</span>
</code></pre>
<p>Podemos novamente visualizá-la através do comando &quot;docker image ls&quot;.</p>
<pre><code class="lang-bash">root@linuxtips:~<span class="hljs-comment"># docker image ls</span>
REPOSITORY           TAG  IMAGE ID        CREATED             SIZE
linuxtips/apache     1.0  4862def18dfd    About an hour ago   193.4 MB

root@linuxtips:~<span class="hljs-comment">#</span>
</code></pre>
<p>Para criar o <em>container</em> utilizando nossa imagem:</p>
<pre><code class="lang-bash">root@linuxtips:~<span class="hljs-comment"># docker container run -d linuxtips/apache:1.0</span>
</code></pre>
<p>Simples como voar, não?</p>
<h2 id="94-não-confio-na-internet-posso-criar-o-meu-registry-local">9.4. Não confio na internet; posso criar o meu <em>registry</em> local?</h2>
<p>Como muitas empresas não gostam de manter seus dados na nuvem em
serviços de terceiros, existe a possibilidade de você configurar um
<em>registry</em> local. Assim, você não precisa utilizar o <em>registry</em> do
Docker Hub, por exemplo. Isso permite a você compartilhar suas imagens
com outras pessoas de sua empresa, funcionando como repositório de
imagens Docker. Sensacional!</p>
<p>A URL do projeto fica em
<a href="https://github.com/docker/distribution" target="_blank">https://github.com/docker/distribution</a>.
O Docker Distribution é um <em>registry</em> que serve para guardar e
compartilhar suas imagens. Ele substitui o Docker Registry, que se
tornou obsoleto.</p>
<p>Para que possamos ter o Docker Distribution de forma simples e
totalmente funcional, guardando e distribuindo nossas imagens Docker
localmente, basta rodá-lo como um <em>container</em>! :D</p>
<pre><code class="lang-bash">root@linuxtips:~<span class="hljs-comment"># docker container run -d -p 5000:5000 --restart=always --name registry registry:2</span>
Unable to find image <span class="hljs-string">&apos;registry:2&apos;</span> locally
2: Pulling from library/registry
fdd5d7827f33: Already exists
a3ed95caeb02: Pull complete
a79b4a92697e: Pull complete
6cbb75c7cc30: Pull complete
4831699594bc: Pull complete
Digest: sha256:20f5d95004b71fe14dbe7468eff33f18ee7fa52502423c5d107d4fb0abb05c1d
Status: Downloaded newer image <span class="hljs-keyword">for</span> registry:2
4f8efc8a71531656dc74e99dea74da203645c0f342b0706bc74200ae0a50cb20

root@linuxtips:~<span class="hljs-comment">#</span>
</code></pre>
<p>Com o comando anterior, criamos um <em>container</em> chamado &quot;registry&quot; que
utiliza a imagem &quot;registry:2&quot; como base e usamos a opção
&quot;--restart=always&quot;. Caso ocorra qualquer problema com o <em>container</em> ou
com o Docker, ele será iniciado automaticamente. Passamos também que a
porta de comunicação com o <em>container</em> será a 5000, que também utilizará
a porta 5000 do <em>host</em> com o mesmo propósito. Vamos ver sobre o
parâmetro &quot;-p&quot; em breve, no capítulo relacionado a redes. ;)</p>
<p>Você pode verificar o <em>container</em> do <em>registry</em> em execução, bem como
sua imagem:</p>
<pre><code class="lang-bash"><span class="hljs-comment"># docker container ls</span>
<span class="hljs-comment"># docker image ls</span>
</code></pre>
<p>Muito bom, nosso <em>registry</em> já está em execução! Agora vamos testá-lo
tentando realizar um <em>push</em> da nossa imagem para ele.</p>
<p>Primeiramente, teremos que adicionar uma nova <em>tag</em> em nossa imagem
mencionando o endereço do novo <em>registry</em> em vez do nome do usuário que
utilizávamos quando queríamos fazer o <em>push</em> para o Docker Hub. Para
isso, vamos utilizar novamente o comando &quot;docker tag&quot;:</p>
<pre><code class="lang-bash"><span class="hljs-comment"># docker tag IMAGEMID localhost:5000/apache</span>
<span class="hljs-comment"># docker image ls</span>
</code></pre>
<p>Agora basta fazer o <em>push</em> para o nosso <em>registry</em> local da seguinte
forma:</p>
<pre><code class="lang-bash">root@linuxtips:~<span class="hljs-comment"># docker push localhost:5000/apache</span>
The push refers to a repository [localhost:5000/apache]
b3a691489ee1: Pushed
5f70bf18a086: Pushed
917c0fc99b35: Pushed
latest: digest: sha256:0e69b8d5cea67fcfedb5d7128a9fd77270461aa5852e6fe9b465565ec8e4e12f size: 925

root@linuxtips:~<span class="hljs-comment">#</span>
</code></pre>
<p>Pronto! Agora nós possuímos um <em>registry</em> local!</p>
<p>Fizemos um <em>registry</em> totalmente funcional, porém simples. Caso queira
utilizar recursos como controle de usuários, certificados, outras opções
de <em>storage</em>, etc., visite a página do projeto no GitHub:
<a href="https://github.com/docker/distribution" target="_blank">https://github.com/docker/distribution</a>.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="chapter_08.html" class="navigation navigation-prev " aria-label="Previous page: Criando e gerenciando imagens">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="chapter_10.html" class="navigation navigation-next " aria-label="Next page: Gerenciando a rede dos containers">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Compartilhando as imagens","level":"2.10","depth":1,"next":{"title":"Gerenciando a rede dos containers","level":"2.11","depth":1,"path":"chapters/chapter_10.md","ref":"chapters/chapter_10.md","articles":[]},"previous":{"title":"Criando e gerenciando imagens","level":"2.9","depth":1,"path":"chapters/chapter_08.md","ref":"chapters/chapter_08.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"chapters/chapter_09.md","mtime":"2021-08-11T21:31:30.702Z","type":"markdown"},"gitbook":{"version":"3.6.20","time":"2021-08-11T21:31:40.998Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

